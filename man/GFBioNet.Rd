% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/GFBioNet.R
\name{GFBioNet}
\alias{GFBioNet}
\title{Fast bias-corrected node-wise regression with FDR control for \eqn{X \times G}}
\usage{
GFBioNet(
  X,
  G,
  standardize = FALSE,
  basenet = NULL,
  nsignals1 = 100,
  nsignals2 = 1000,
  nlambda = 30,
  lambda.min = NULL,
  lambda.max = NULL,
  alpha = 1,
  sym = "or",
  qfdr1 = 0.1,
  qfdr2 = 0.1,
  r1 = 0.5,
  r2 = 0.7,
  topL_mu = 3,
  ncores = max(1L, parallel::detectCores(logical = TRUE) - 1L)
)
}
\arguments{
\item{X}{A numeric matrix of size \eqn{N \times M} (samples \eqn{\times} traits).}

\item{G}{A numeric matrix of size \eqn{N \times T} (samples \eqn{\times} genomic factors).
Interactions \eqn{X \times G} are formed internally (element-wise products by column).}

\item{standardize}{Logical flag for standardization of the columns of \code{X} and \code{G},
prior to fitting the model sequence. Default: \code{FALSE}.}

\item{basenet}{Optional \eqn{M \times M} adjacency (0/1 or -/+) matrix from an initial
Gaussian graphical model. If \code{NULL} (default), the base network is estimated
internally using node-wise penalized regression and symmetrized by \code{sym}.
The diagonal is required to be zero.}

\item{nsignals1}{Integer. If \code{basenet} is \code{NULL} To estimate the base network (stage 1),
the rough upper bound on the number of non-null signals used to construct the \eqn{\lambda} range.
Default: \code{100}.}

\item{nsignals2}{Integer; rough upper bound on the number of non-null signals used to
construct the \eqn{\lambda} range. Default: \code{1000}.}

\item{nlambda}{Integer; number of penalty values in the path. Default: \code{30}.}

\item{lambda.min, lambda.max}{Optional numeric bounds for the penalty path. If either
is \code{NULL}, bounds are computed by \code{lambda.lower}/\code{lambda.upper}
heuristics given \code{N}, \code{M}, \code{T}, \code{alpha}, and \code{nsignals}.}

\item{alpha}{Elastic-net mixing parameter passed to \pkg{glmnet}: \code{alpha = 1}
gives lasso; \code{0 < alpha < 1} gives elastic net (ridge component included).
Bias is estimated accordingly (lasso and EN formulas are handled internally).}

\item{sym}{Character; symmetrization rule for the undirected base network:
\code{"or"} (default) uses the union of directed edges, \code{"and"} uses the
intersection.}

\item{qfdr1}{Numeric in (0,1); target FDR level for the base-network stage (stage 1).
Default: \code{0.1}.}

\item{qfdr2}{Numeric in (0,1); target FDR level for the interaction stage (stage 2). Default: \code{0.1}.}

\item{r1}{Numeric in (0,1); “strong-correlation” threshold used to thin highly
correlated detections and to define the exclusion set when computing bias-adjusted
false-positive counts. Default: \code{0.5}.}

\item{r2}{Numeric in (0,1); reserved for stricter correlation handling. Default: \code{0.7}.}

\item{topL_mu}{Integer; number of strongest neighbors (by absolute correlation) used
to accumulate the lasso bias term \eqn{\mu} per detected predictor. For elastic net,
bias uses the analytical \eqn{\delta} factor and does not require top-\eqn{L}
truncation. Default: \code{3}.}

\item{ncores}{Integer; number of CPU cores for parallel node-wise fits. Defaults to
\code{max(1, parallel::detectCores() - 1)}.}
}
\value{
A named \code{list} with:
\item{fit}{Signals detected.}
\item{signals}{Length-\code{nlambda} list of sparse \eqn{M \times M} coefficient
matrices (directed node-wise fits after correlation-thinning at each \eqn{\lambda}).}
\item{basenet}{The symmetrized base adjacency used for node-wise interaction screening.}
\item{lambda}{Numeric vector of length \code{nlambda} with penalty values.}
\item{opt.index}{Index of the selected \eqn{\lambda} based on the FDR curve.}
\item{dfres}{Data frame with columns: \code{lambda}, \code{exp.false} (expected false
positives), \code{detections}, and \code{fdr}.}
\item{beta.fit}{Sparse matrix: coefficients at the selected \eqn{\lambda}.}
\item{path.fit}{Absolute-value adjacency used to form the undirected graph by
\code{sym}.}
}
\description{
Graph-guided, bias-corrected FDR control for \eqn{X \times G} interactions
}
\details{
\code{GFBioNet} fits a Gaussian graphical model via node-wise regression
and estimates interaction effects between biological traits \eqn{X} and genomic
factors \eqn{G}. The procedure uses correlation screening to build an interaction
graph, performs penalized regression (lasso or elastic net) at a path of
\eqn{\lambda} values, corrects for bias induced by correlated predictors,
and estimates the expected number of false positives to control the FDR.

\strong{Algorithm (high level)}:
\enumerate{
\item Fit/obtain a base network over \eqn{X} (Gaussian graphical model via node-wise
penalized regression), then symmetrize by \code{sym}.
\item Build the interaction design \eqn{X \times G} and a correlation screening graph
combining: (i) \eqn{X}-only correlations replicated across \eqn{G}, (ii) \eqn{G}-only
correlations replicated across \eqn{X}, and (iii) cross terms.
\item For each node \eqn{i} and for each \eqn{\lambda}:
\enumerate{
\item Fit \pkg{glmnet} (lasso/EN) including \emph{main effects} (neighboring \eqn{X}
and all \eqn{G}) and \emph{interactions} pre-screened to neighbors of \eqn{i}.
\item Thin highly correlated detections using \code{r1} (keep stronger by absolute
coefficient).
\item Compute expected false positives in two pools (uncorrelated vs correlated),
applying bias correction \eqn{\mu}:
\itemize{
\item Lasso: \eqn{\mu_z = \lambda \, \mathrm{sign}(\beta_t)\, \mathrm{cor}(z,t)}.
\item Elastic net: \eqn{\delta_t = \frac{(1 + \hat{b}_{OLS,t})\, \alpha \lambda}{1 + \alpha \lambda}},\;
\eqn{\mu_z = \delta_t \cdot \mathrm{cor}(z,t)} with \eqn{\hat{b}_{OLS,t}}
computed from the pre-thinning residual for exact parity with the baseline.
}
\item Accumulate the expected false positives and detections to estimate the FDR
along the path and select an optimal \eqn{\lambda}.
}
}

The implementation keeps the baseline math intact while using cached adjacency lists,
vectorized variance updates, and sparse triplet assembly for speed.
}
\section{Notes}{

\itemize{
\item \code{alpha = 1} (lasso) and \code{0 < alpha < 1} (elastic net) are supported.
\item Columns of \code{X} and \code{G} should be on comparable scales if effect-size
comparability is desired; interactions are standardized internally.
\item The diagonal of \code{basenet} must be zero; if \code{basenet = NULL} the function
estimates it internally (recommended for end-to-end runs).
}
}

\author{
Samuel Anyaso-Samuel
}
